.SUFFIXES: .o .mod .f08

# Compiler
FC  = gfortran 

# Flags
OFLAGS = -O3 -funroll-loops # -Optimization
DFLAGS = -g3 -finit-real=snan -fbacktrace -fcheck=all -ffpe-summary=all # debugging
WFLAGS = -Wall -Wextra -pedantic -std=f2008 -fall-intrinsics -Warray-temporaries -Wcharacter-truncation -Wconversion-extra # warnings

# Compiling rules, .o and .mod files both depend on .f08 and are both produced by a single invocation of gfortran
%.o %.mod: %.f08
	$(FC) $(OFLAGS) $(WFLAGS) -c -o $@ $<

# Object modules
OBJ = fortranFunctions.o arrayFunctions.o applications.o

# Default targets
all: Quantum_Now Testing

# 'Quantum_Now' (target) depends on all OBJ files and main.o
Quantum_Now: $(OBJ) main.o
	$(FC) -o $@ $(OFLAGS) $(WFLAGS) $^

Testing: $(OBJ) retireFunctions.o testingFunctions.o
	$(FC) -o $@ $(OFLAGS) $(WFLAGS) $^

# Deletes files generated by compilation
clean:
	rm -f *.o *.mod Quantum_Now Testing PLOT output.png plot_directions

run-m: Quantum_Now
	./Quantum_Now

run-t: Testing
	./Testing

# Dependencies
fortranFunctions.mod: 
arrayFunctions.mod: arrayFunctions.f08 fortranFunctions.mod
retireFunctions.mod: retireFunctions.f08 fortranFunctions.mod arrayFunctions.mod
applications.mod: applications.f08 fortranFunctions.mod arrayFunctions.mod

fortranFunctions.o: 
arrayFunctions.o: arrayFunctions.f08 fortranFunctions.mod
retireFunctions.o: retireFunctions.f08 fortranFunctions.mod arrayFunctions.mod
applications.o: applications.f08 fortranFunctions.mod arrayFunctions.mod
testingFunctions.o: testingFunctions.f08 fortranFunctions.mod retireFunctions.mod arrayFunctions.mod applications.mod
main.o: main.f08 fortranFunctions.mod arrayFunctions.mod applications.mod

